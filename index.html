<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>FrameQuote ‚Äî Global Production Estimator</title><style>:root{--bg0:#070a10;--bg1:#0c1422;--glass:#0f1a2add;--ink:#eaf1ff;--muted:#a8b6d6;--accent:#5dd5ff;--accent2:#78f0d0;--stroke:rgba(255,255,255,.08);--glow:0 0 0 1px rgba(120,240,208,.15),0 8px 24px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.05)}*{box-sizing:border-box}html,body{height:100%}body{margin:0;color:var(--ink);font:15px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial;background:radial-gradient(1300px 920px at 20% -10%,rgba(93,213,255,.22),transparent 45%),radial-gradient(980px 760px at 88% 118%,rgba(120,240,208,.20),transparent 45%),linear-gradient(180deg,var(--bg0),var(--bg1))}.container{max-width:1240px;margin:28px auto 100px;padding:0 18px}.card{background:var(--glass);backdrop-filter:blur(14px) saturate(120%);-webkit-backdrop-filter:blur(14px) saturate(120%);border:1px solid var(--stroke);border-radius:18px;padding:18px;box-shadow:var(--glow)}.ghost{background:transparent;border:1px solid var(--stroke)}.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.grid{display:grid;gap:16px}.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.title{font-size:24px;font-weight:900;color:#dff6ff;text-shadow:0 1px 0 rgba(255,255,255,.06)}.logoTxt{font-weight:900;letter-spacing:.3px;color:#dff6ff;cursor:pointer;font-size:22px;display:flex;align-items:center;gap:10px}.appLogo{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 35% 20%,#bff8ff 0%,#5dd5ff 40%,#2a7e9a 75%,#0b2633 100%);box-shadow:0 0 0 1px rgba(93,213,255,.45),0 6px 18px rgba(0,0,0,.55) inset;font-size:18px}.muted{color:var(--muted)}.small{font-size:12px;color:var(--muted)}label{font-weight:700;color:#dbe8ff;display:block;margin-bottom:6px}.pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:rgba(10,16,26,.35);color:#cfe3ff;border:1px solid var(--stroke)}input,textarea{width:100%;padding:12px 14px;border-radius:14px;border:1px solid var(--stroke);color:var(--ink);background:rgba(10,16,26,.45);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);font-size:15px}input[type=number]{text-align:right}select{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:100%;padding:12px 44px 12px 14px;border-radius:14px;border:1px solid var(--stroke);color:var(--ink);background:rgba(10,16,26,.45) no-repeat right 12px center;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23a8b6d6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-size:18px 18px}option{background:#0c1422;color:#eaf1ff}.btn{cursor:pointer;border:1px solid var(--stroke);color:var(--ink);padding:12px 16px;border-radius:14px;font-weight:800;letter-spacing:.2px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));box-shadow:var(--glow);transition:transform .12s ease,box-shadow .12s ease}.btn:hover{box-shadow:0 0 0 1px rgba(93,213,255,.35),0 12px 36px rgba(0,0,0,.5)}.btn:active{transform:translateY(1px)}.btn.brand{border-color:rgba(93,213,255,.35);background:linear-gradient(180deg,rgba(93,213,255,.28),rgba(120,240,208,.18));box-shadow:0 0 0 1px rgba(93,213,255,.4),0 10px 28px rgba(93,213,255,.2)}.btn.link{border:none;background:transparent;padding:4px 6px;color:#9fb2d9;font-size:12px}table{width:100%;border-collapse:collapse}th,td{padding:12px 10px}thead th{color:#e9f5ff;text-align:left;font-size:13px;letter-spacing:.2px;border-bottom:1px solid var(--stroke)}tbody td{border-bottom:1px solid rgba(255,255,255,.05)}tfoot td{font-weight:900}.right{text-align:right}
/* ===== Preview ONLY ‚Äî high readability ===== */
#printArea{background:#ffffff;border-radius:16px;padding:16px;border:1px solid #e4e9f5;color:#0b1220}
#printArea .miniCard{background:#f7f9ff;border:1px solid #d9e1f3;border-radius:12px;padding:12px;color:#0b1220}
#printHeader{background:linear-gradient(180deg,#1a2235,#131a2a);color:#ffffff;padding:12px;border-radius:12px;margin:-6px -6px 12px -6px;display:flex;align-items:center;justify-content:space-between}
#printArea thead th{color:#0b1220}
#p_table th,#p_table td{color:#0b1220;border-bottom:1px solid #e6ecf7}
#memoLabel{color:#0b1220;font-weight:700}
#memoBox{border-radius:12px;padding:10px;min-height:120px;background:#f7faff;border:1px solid #e1e9f8;color:#0b1220}
#p_subtotal,#p_complexAmt,#p_marginAmt,#p_vatAmt,#p_grand{color:#0b1220;font-weight:700}
/* ===== Modals ‚Äî keep centered & above all ===== */
.modal{display:none;position:fixed;inset:0;background:rgba(3,6,10,.55);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);align-items:center;justify-content:center;z-index:9999}
@media print{body{background:#fff;color:#000}.no-print{display:none!important}#printArea{box-shadow:none;background:#fff}}
footer{margin-top:60px;padding:40px 0;text-align:center;color:#9fb2d9;border-top:1px solid rgba(255,255,255,0.08);font-size:13px}.error{border-color:#ff5a7a!important;box-shadow:0 0 0 2px rgba(255,90,122,.15) inset}
</style></head><body><div class="container"><div class="row" style="justify-content:space-between;align-items:center"><div class="logoTxt" id="brandName"><span class="appLogo" aria-hidden="true">üìÑ</span><span id="brandText">FrameQuote</span></div><div class="row"><button class="btn" id="btnProTop">Pro</button><button class="btn" id="btnLoginOpen">Î°úÍ∑∏Ïù∏</button></div></div><div class="grid cols-4 card" style="margin-top:16px"><div><label id="lblClient">Client / Project</label><input id="client"/></div><div><label id="lblDate">Date</label><input id="date" type="date"/></div><div><label id="lblUILang">UI Language</label><select id="uiLang"><option value="ko">ÌïúÍµ≠Ïñ¥</option><option value="en" selected>English</option><option value="ja">Êó•Êú¨Ë™û</option></select></div><div><label id="lblCurrency">Currency</label><select id="currency"><option value="KRW">‚Ç© KRW</option><option value="USD" selected>$ USD</option><option value="GBP">¬£ GBP</option><option value="AUD">A$ AUD</option><option value="CAD">CA$ CAD</option><option value="EUR">‚Ç¨ EUR</option><option value="JPY">¬• JPY</option></select><div id="fxStatus" class="small"></div></div><div><label id="lblPreset">Project Type (Preset)</label><select id="preset"></select></div><div><label id="lblVAT">VAT (%)</label><input id="vat" type="number" value="10" min="0" max="30"/></div><div><label id="lblProps">Props (%)</label><select id="propsLevel"><option value="0">0%</option><option value="5">5%</option><option value="10">10%</option><option value="15">15%</option></select></div><div><label id="lblArt">Art/Set (%)</label><select id="artLevel"><option value="0">0%</option><option value="7">7%</option><option value="12">12%</option><option value="20">20%</option></select></div><div><label id="lblLoc">Location (%)</label><select id="locLevel"><option value="0">0%</option><option value="5">5%</option><option value="10">10%</option><option value="15">15%</option></select></div></div><div class="card" style="margin-top:16px"><div class="row" style="justify-content:space-between;align-items:center;gap:12px"><div class="row" style="gap:10px"><span class="pill" id="lblItems">Items</span><span class="small muted" id="lblHint">Add labor, gear, studio, post, props, art, location‚Ä¶</span></div><div class="row no-print" style="gap:8px"><button class="btn" id="add">+ <span id="btnAddTxt">Add</span></button><button class="btn" id="clear"><span id="btnClearTxt">Clear</span></button><button class="btn" id="btnProps">Props</button><button class="btn" id="btnArt">Art</button><button class="btn" id="btnLoc">Location</button><button class="btn" id="btnTalent">Talent</button><button class="btn" id="btnMakeup">Makeup</button></div></div><div style="overflow:auto;margin-top:10px"><table id="items"><thead><tr><th style="width:20%" id="thCat">Category</th><th id="thDesc">Description</th><th class="right" style="width:14%" id="thUnit">Unit</th><th class="right" style="width:10%" id="thQty">Qty</th><th class="right" style="width:16%" id="thSub">Subtotal</th><th class="no-print" style="width:64px" id="thDel">Del</th></tr></thead><tbody id="itemsBody"></tbody><tfoot><tr><td colspan="4" class="right" id="tfSubtotal">Subtotal</td><td class="right" id="subtotal">0</td><td class="no-print"></td></tr><tr><td colspan="4" class="right" id="tfComplex">Complexity Weight (<span id="cPctView">0</span>%)</td><td class="right" id="complexAmt">0</td><td class="no-print"></td></tr><tr><td colspan="4" class="right" id="tfMargin">Margin (<span id="mPct">15</span>%)</td><td class="right" id="marginAmt">0</td><td class="no-print"></td></tr><tr><td colspan="4" class="right" id="tfVAT">VAT (<span id="vPct">10</span>%)</td><td class="right" id="vatAmt">0</td><td class="no-print"></td></tr><tr><td colspan="4" class="right" id="tfTotal">Total</td><td class="right" id="grand">0</td><td class="no-print"></td></tr></tfoot></table></div></div><div class="grid cols-2" style="margin-top:16px"><div class="card"><label id="lblNotes">Notes / Scope / Exclusions</label><textarea id="notes" rows="6"></textarea></div><div class="card"><label id="lblVendor">Vendor Info</label><textarea id="vendor" rows="6"></textarea></div></div><div id="printArea" class="card" style="margin-top:18px"><div id="printHeader" class="row"><div class="row" style="gap:8px;align-items:center"><span class="appLogo" id="pdfBrandIcon">üìÑ</span><div><div class="small" id="printLabel">PDF ÎØ∏Î¶¨Î≥¥Í∏∞</div><h2 id="p_title" style="margin:4px 0 2px">QUOTATION</h2><div class="small" id="p_client">Client</div><div class="small" id="p_date">YYYY-MM-DD</div></div></div><div id="p_vendor" class="small" style="white-space:pre-line;text-align:right"></div></div><table id="p_table"><thead><tr><th id="p_thCat">Category</th><th id="p_thDesc">Description</th><th class="right" id="p_thUnit">Unit</th><th class="right" id="p_thQty">Qty</th><th class="right" id="p_thSub">Subtotal</th></tr></thead><tbody></tbody></table><div class="grid cols-2" style="gap:12px;margin-top:10px"><div><div class="small" id="memoLabel" style="margin-bottom:6px">Notes / Scope / Exclusions</div><div id="memoBox" aria-readonly="true"></div></div><div class="miniCard"><div class="row" style="justify-content:space-between"><div id="p_tfSubtotal">Subtotal</div><div id="p_subtotal" class="right">0</div></div><div class="row" style="justify-content:space-between"><div>Complexity (<span id="p_cPct">0</span>%)</div><div id="p_complexAmt" class="right">0</div></div><div class="row" style="justify-content:space-between"><div>Margin (<span id="p_mPct">15</span>%)</div><div id="p_marginAmt" class="right">0</div></div><div class="row" style="justify-content:space-between"><div>VAT (<span id="p_vPct">10</span>%)</div><div id="p_vatAmt" class="right">0</div></div><hr style="border:none;border-top:1px solid #e0e6f6;margin:6px 0"/><div class="row" style="justify-content:space-between"><div><b id="p_tfTotal">Total</b></div><div id="p_grand" class="right"><b>0</b></div></div></div></div><div class="row" style="justify-content:space-between;margin-top:10px"><div class="small" id="p_leftBrand">FrameQuote</div><div class="small" style="font-weight:900">STONFILM</div></div></div><div class="row no-print" style="justify-content:flex-end;margin-top:10px"><button class="btn brand" id="btnPrint">PDF</button></div><div class="card no-print" style="margin-top:16px"><div class="row" style="justify-content:space-between;align-items:center"><div class="title" id="proTitle">FrameQuote Pro</div><button class="btn brand" id="btnUpgrade">Upgrade</button></div></div><div class="modal" id="loginModal" style="display:none"><div class="card" style="width:min(640px,95vw)"><div class="row" style="justify-content:space-between;align-items:center"><div class="title" id="loginTitle">Login</div><button class="btn ghost" id="loginClose">‚úñ</button></div><div class="grid cols-2" style="margin-top:10px"><div><label id="lblEmail">Email</label><input id="authEmail" autocomplete="username" placeholder="name@example.com"/></div><div><label id="lblPass">Password</label><input id="authPass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/></div></div><div class="row" style="gap:8px;margin-top:12px"><button class="btn brand" id="btnLogin">Login</button><button class="btn brand" id="btnGoogle">Login with Google</button></div><div class="row" style="gap:8px;margin-top:8px;align-items:center"><button class="btn ghost" id="btnOpenSignup">Sign up</button><button class="btn link" id="btnForgotPass">Forgot Password</button></div></div></div><div class="modal" id="signupModal" style="display:none"><div class="card" style="width:min(720px,96vw)"><div class="row" style="justify-content:space-between;align-items:center"><div class="title" id="signupTitle">Sign up & Subscribe</div><button class="btn ghost" id="signupClose">‚úñ</button></div><div class="grid cols-3" style="margin-top:10px"><div><label id="lblGender">Gender</label><select id="sgGender"><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div><div><label id="lblPhone">Phone</label><input id="sgPhone" placeholder="+82-10-0000-0000"/></div><div><label id="lblRole">Role</label><select id="sgRole"><option value="company">Company</option><option value="student">Student</option><option value="freelancer">Freelancer</option><option value="other">Other</option></select></div></div><div class="grid cols-3" style="margin-top:10px"><div><label id="lblEmail2">Email</label><input id="sgEmail" placeholder="name@example.com"/></div><div><label id="lblVerify">Verification Code</label><div class="row"><input id="sgCode" placeholder="123456" style="flex:1"/><button class="btn" id="btnSendCode">Send</button></div></div><div><label id="lblPassword">Password</label><input id="sgPass" type="password"/></div></div><div class="grid cols-2" id="roleExtras" style="margin-top:10px"></div><div class="grid cols-2" style="margin-top:10px"><div><label id="lblPassConfirm">Confirm Password</label><input id="sgPass2" type="password"/></div></div><div class="card" style="margin-top:10px"><div class="row" style="justify-content:space-between;align-items:center"><div><b id="lblCardReg">Card for auto-charge</b> <span class="small" id="lblCardHint">$5 every 30 days</span></div><button class="btn brand" id="btnSubscribe">Subscribe</button></div><div class="small muted" id="lblCardDesc">Redirect to secure checkout (stub). After subscribing, Pro features unlock automatically.</div></div></div></div><div class="modal" id="upgradeModal" style="display:none"><div class="card" style="width:min(640px,95vw)"><div class="row" style="justify-content:space-between;align-items:center"><div class="title" id="upgradeTitle">FrameQuote Pro</div><button class="btn ghost" id="upgradeClose">‚úñ</button></div><div class="small" id="upgradeDesc" style="margin-top:6px">$5 billed every 30 days. Cancel anytime. "Í¥ëÍ≥†Ï†úÍ±∞" Í∞ÄÎä•. PDFÏóêÏÑú Î™®Îì† Î°úÍ≥† Ï†úÍ±∞Îê©ÎãàÎã§.</div><ul class="small" style="line-height:1.9;margin:10px 0"><li id="f1">Unlimited presets (cloud)</li><li id="f2">Team share & read-only links</li><li id="f3">Export XLSX / PPTX / DOCX / CSV</li><li id="f4">Brand logo/themes, version history</li></ul><div class="row" style="gap:8px;justify-content:flex-end"><button class="btn" id="btnUpLogin">Login</button><button class="btn brand" id="btnUpSignup">Sign up</button></div></div></div></div><footer><div style="font-weight:900;margin-bottom:6px">STONFILM</div><div>Powered by STONFILM ‚Äî Creative AI & VFX Studio</div><div style="margin-top:4px;color:#7c8aa5">¬© 2025 STONFILM. All rights reserved.</div></footer><script>const $=(q,ctx=document)=>ctx.querySelector(q),$$=(q,ctx=document)=>Array.from(ctx.querySelectorAll(q));const fmt2=n=>Math.round((n+Number.EPSILON)*100)/100;let proMode=false,localeUI='ko',currency='USD',marginPct=15;const safe=(el,cb)=>{if(el)cb(el)};const setText=(sel,txt)=>{const el=$(sel);if(el)el.textContent=txt};const setHTML=(sel,html)=>{const el=$(sel);if(el)el.innerHTML=html};const I18N={en:{brand:'FrameQuote',client:'Client / Project',date:'Date',ui:'UI Language',preset:'Project Type (Preset)',currency:'Currency',vat:'VAT (%)',items:'Items',hint:'Add labor, gear, studio, post, props, art, location‚Ä¶',cat:'Category',desc:'Description',unit:'Unit',qty:'Qty',sub:'Subtotal',del:'Del',subtotal:'Subtotal',complex:'Complexity Weight',margin:'Margin',vatlabel:'VAT',total:'Total',add:'Add',clear:'Clear',props:'Props (%)',art:'Art/Set (%)',loc:'Location (%)',notes:'Notes / Scope / Exclusions',vendor:'Vendor Info',quotation:'QUOTATION',pro:'FrameQuote Pro',login:'Login',loginWithGoogle:'Login with Google',signup:'Sign up',forgot:'Forgot Password',email:'Email',password:'Password',passConfirm:'Confirm Password',gender:'Gender',phone:'Phone',role:'Role',verification:'Verification Code',send:'Send',cardReg:'Card for auto-charge',cardHint:'$5 every 30 days',cardDesc:'Redirect to secure checkout (stub). After subscribing, Pro features unlock automatically.',subscribe:'Subscribe',upgradeTitle:'FrameQuote Pro',upgradeDesc:'$5 billed every 30 days. Cancel anytime. Ad removal. Logos removed from PDF.',company:'Company',student:'Student',freelancer:'Freelancer',other:'Other',signupDone:'Sign-up completed.',pdfPreview:'PDF Preview'},ko:{brand:'ÌîÑÎ†àÏûÑÏøºÌä∏',client:'Í≥†Í∞ù / ÌîÑÎ°úÏ†ùÌä∏',date:'ÎÇ†Ïßú',ui:'UI Ïñ∏Ïñ¥',preset:'ÌîÑÎ°úÏ†ùÌä∏ Ïú†Ìòï(ÌîÑÎ¶¨ÏÖã)',currency:'ÌÜµÌôî',vat:'Î∂ÄÍ∞ÄÏÑ∏(%)',items:'Ìï≠Î™©',hint:'Ïù∏Í±¥ÎπÑ, Ïû•ÎπÑ, Ïä§ÌäúÎîîÏò§, ÌõÑÎ∞ò, ÏÜåÌíà¬∑ÎØ∏Ïà†¬∑Î°úÏºÄÏù¥ÏÖò Îì± Ï∂îÍ∞Ä',cat:'Ïπ¥ÌÖåÍ≥†Î¶¨',desc:'ÏÑ§Î™Ö',unit:'Îã®Í∞Ä',qty:'ÏàòÎüâ',sub:'ÏÜåÍ≥Ñ',del:'ÏÇ≠Ï†ú',subtotal:'ÏÜåÍ≥Ñ',complex:'Î≥µÏû°ÎèÑ Í∞ÄÏ§ëÏπò',margin:'ÎßàÏßÑ',vatlabel:'Î∂ÄÍ∞ÄÏÑ∏',total:'Ï¥ùÏï°',add:'Ï∂îÍ∞Ä',clear:'Ï¥àÍ∏∞Ìôî',props:'ÏÜåÌíà(%)',art:'ÎØ∏Ïà†/ÏÑ∏Ìä∏(%)',loc:'Î°úÏºÄÏù¥ÏÖò(%)',notes:'ÌäπÏù¥ÏÇ¨Ìï≠ / ÎÇ©ÌíàÎ≤îÏúÑ / Ï†úÏô∏',vendor:'Í≥µÍ∏âÏûê Ï†ïÎ≥¥',quotation:'Í≤¨Ï†ÅÏÑú',pro:'ÌîÑÎ†àÏûÑÏøºÌä∏ Pro',login:'Î°úÍ∑∏Ïù∏',loginWithGoogle:'Íµ¨Í∏ÄÎ°ú Î°úÍ∑∏Ïù∏',signup:'ÌöåÏõêÍ∞ÄÏûÖ',forgot:'ÎπÑÎ∞ÄÎ≤àÌò∏ Ï∞æÍ∏∞',email:'Ïù¥Î©îÏùº',password:'ÎπÑÎ∞ÄÎ≤àÌò∏',passConfirm:'ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏',gender:'ÏÑ±Î≥Ñ',phone:'Ïó∞ÎùΩÏ≤ò',role:'Íµ¨Î∂Ñ',verification:'Ïù∏Ï¶ùÏΩîÎìú',send:'Î∞úÏÜ°',cardReg:'ÏûêÎèôÍ≤∞Ï†úÏö© Ïπ¥Îìú',cardHint:'30ÏùºÎßàÎã§ $5',cardDesc:'ÏïàÏ†ÑÌïú Í≤∞Ï†ú ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô(Îç∞Î™®). Íµ¨ÎèÖ ÌõÑ Pro Í∏∞Îä•Ïù¥ Ïó¥Î¶ΩÎãàÎã§.',subscribe:'Íµ¨ÎèÖ',upgradeTitle:'ÌîÑÎ†àÏûÑÏøºÌä∏ Pro',upgradeDesc:'30ÏùºÎßàÎã§ $5 Í≤∞Ï†ú. Ïñ∏Ï†úÎì† Ìï¥ÏßÄ. Í¥ëÍ≥†Ï†úÍ±∞ Î∞è PDF Î°úÍ≥† Ï†úÍ±∞.',company:'ÌöåÏÇ¨',student:'ÌïôÏÉù',freelancer:'ÌîÑÎ¶¨ÎûúÏÑú',other:'Í∏∞ÌÉÄ',signupDone:'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',pdfPreview:'PDF ÎØ∏Î¶¨Î≥¥Í∏∞'},ja:{brand:'„Éï„É¨„Éº„É†„ÇØ„Ç©„Éº„Éà',client:'„ÇØ„É©„Ç§„Ç¢„É≥„Éà / „Éó„É≠„Ç∏„Çß„ÇØ„Éà',date:'Êó•‰ªò',ui:'UI Ë®ÄË™û',preset:'„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Çø„Ç§„Éó(„Éó„É™„Çª„ÉÉ„Éà)',currency:'ÈÄöË≤®',vat:'Ê∂àË≤ªÁ®é(%)',items:'È†ÖÁõÆ',hint:'‰∫∫‰ª∂Ë≤ª„ÉªÊ©üÊùê„Éª„Çπ„Çø„Ç∏„Ç™„Éª„Éù„Çπ„Éà„ÉªÂ∞èÈÅìÂÖ∑„ÉªÁæéË°ì„Éª„É≠„Ç±„Å™„Å©',cat:'„Ç´„ÉÜ„Ç¥„É™',desc:'Ë™¨Êòé',unit:'Âçò‰æ°',qty:'Êï∞Èáè',sub:'Â∞èË®à',del:'ÂâäÈô§',subtotal:'Â∞èË®à',complex:'Ë§áÈõëÂ∫¶‰øÇÊï∞',margin:'„Éû„Éº„Ç∏„É≥',vatlabel:'Ê∂àË≤ªÁ®é',total:'ÂêàË®à',add:'ËøΩÂä†',clear:'„ÇØ„É™„Ç¢',props:'Â∞èÈÅìÂÖ∑(%)',art:'ÁæéË°ì/„Çª„ÉÉ„Éà(%)',loc:'„É≠„Ç±(%)',notes:'ÂÇôËÄÉ / ÁØÑÂõ≤ / Èô§Â§ñ',vendor:'‰æõÁµ¶ËÄÖÊÉÖÂ†±',quotation:'Ë¶ãÁ©çÊõ∏',pro:'FrameQuote Pro',login:'„É≠„Ç∞„Ç§„É≥',loginWithGoogle:'Google„Åß„É≠„Ç∞„Ç§„É≥',signup:'ÁôªÈå≤',forgot:'„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„Åü',email:'„É°„Éº„É´',password:'„Éë„Çπ„ÉØ„Éº„Éâ',passConfirm:'„Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç',gender:'ÊÄßÂà•',phone:'ÈõªË©±',role:'Âå∫ÂàÜ',verification:'Á¢∫Ë™ç„Ç≥„Éº„Éâ',send:'ÈÄÅ‰ø°',cardReg:'Ëá™ÂãïË™≤Èáë„Ç´„Éº„Éâ',cardHint:'30Êó•„Åî„Å® $5',cardDesc:'ÂÆâÂÖ®„Å™Ê±∫Ê∏à„Éö„Éº„Ç∏„Å∏(„Éá„É¢)„ÄÇË≥ºË™≠Âæå„Å´ProÊ©üËÉΩ„ÅåËß£Êîæ„ÄÇ',subscribe:'Ë≥ºË™≠',upgradeTitle:'FrameQuote Pro',upgradeDesc:'30Êó•„Åî„Å®$5„ÄÇ„ÅÑ„Å§„Åß„ÇÇËß£Á¥ÑÂèØ„ÄÇÂ∫ÉÂëäÈô§Âéª„ÉªPDF„É≠„Ç¥ÂâäÈô§„ÄÇ',company:'‰ºöÁ§æ',student:'Â≠¶Áîü',freelancer:'„Éï„É™„Éº„É©„É≥„Çπ',other:'„Åù„ÅÆ‰ªñ',signupDone:'ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ',pdfPreview:'PDF „Éó„É¨„Éì„É•„Éº'}};const PRESET_TEXT={ko:{custom:'ÏÇ¨Ïö©Ïûê Ï†ïÏùò',shorts:'ÏÑ∏Î°ú ÏàèÌèº(1Î∂Ñ Ïù¥Ìïò)',youtube:'Ïú†ÌäúÎ∏å Í¥ëÍ≥†(15‚Äì30Ï¥à)',mv:'ÎÆ§ÏßÅÎπÑÎîîÏò§(1Ïùº Ï¥¨ÏòÅ)',cf:'TVC/CF(1‚Äì3Î∂Ñ, 2Ïùº)',event:'Ïù¥Î≤§Ìä∏/ÎùºÏù¥Î∏å',threeD:'3D Ïï†ÎãàÎ©îÏù¥ÏÖò(ÏÑ∏Í∑∏Î®ºÌä∏)',long10:'Î°±Ìèº 10Î∂Ñ',long30:'Î°±Ìèº 30Î∂Ñ',long60:'Î°±Ìèº 60Î∂Ñ'},en:{custom:'Custom',shorts:'Vertical Shorts (‚â§1m)',youtube:'YouTube Ads (15‚Äì30s)',mv:'Music Video (1-day shoot)',cf:'TVC/CF (1‚Äì3m, 2 days)',event:'Event / Live',threeD:'3D Animation (segment)',long10:'Long-form 10m',long30:'Long-form 30m',long60:'Long-form 60m'},ja:{custom:'„Ç´„Çπ„Çø„É†',shorts:'Á∏¶Âûã„Ç∑„Éß„Éº„Éà („Äú1ÂàÜ)',youtube:'YouTube Â∫ÉÂëä (15‚Äì30Áßí)',mv:'„Éü„É•„Éº„Ç∏„ÉÉ„ÇØ„Éì„Éá„Ç™ (1Êó•ÊíÆÂΩ±)',cf:'TVC/CF (1‚Äì3ÂàÜ„Éª2Êó•)',event:'„Ç§„Éô„É≥„Éà / „É©„Ç§„Éñ',threeD:'3D „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ („Çª„Ç∞„É°„É≥„Éà)',long10:'„É≠„É≥„Ç∞„Éï„Ç©„Éº„É† 10ÂàÜ',long30:'„É≠„É≥„Ç∞„Éï„Ç©„Éº„É† 30ÂàÜ',long60:'„É≠„É≥„Ç∞„Éï„Ç©„Éº„É† 60ÂàÜ'}};const PRESET_KEYS=['custom','shorts','youtube','mv','cf','event','threeD','long10','long30','long60'];function t(k){return I18N[localeUI]?.[k]||I18N.en[k]||k}function rebuildPresets(){const sel=$('#preset');if(!sel)return;const prev=sel.value;sel.innerHTML='';const map=PRESET_TEXT[localeUI]||PRESET_TEXT.en;PRESET_KEYS.forEach(k=>{const opt=document.createElement('option');opt.value=k;opt.textContent=map[k]||k;sel.appendChild(opt)});sel.value=PRESET_KEYS.includes(prev)?prev:'custom'}function applyI18n(){document.documentElement.lang=localeUI;setText('#brandText',t('brand'));const lo=$('#btnLoginOpen');if(lo&&lo.textContent!=='Logout'&&lo.textContent!=='Î°úÍ∑∏ÏïÑÏõÉ')lo.textContent=t('login');setText('#lblClient',t('client'));setText('#lblDate',t('date'));setText('#lblUILang',t('ui'));setText('#lblPreset',t('preset'));setText('#lblCurrency',t('currency'));setText('#lblVAT',t('vat'));setText('#lblItems',t('items'));setText('#lblHint',t('hint'));setText('#thCat',t('cat'));setText('#thDesc',t('desc'));setText('#thUnit',t('unit'));setText('#thQty',t('qty'));setText('#thSub',t('sub'));setText('#thDel',t('del'));setText('#tfSubtotal',t('subtotal'));setHTML('#tfComplex',`${t('complex')} (<span id="cPctView">${$('#cPctView')?$('#cPctView').textContent:0}</span>%)`);setHTML('#tfMargin',`${t('margin')} (<span id="mPct">${$('#mPct')?$('#mPct').textContent:15}</span>%)`);setHTML('#tfVAT',`${t('vatlabel')} (<span id="vPct">${$('#vPct')?$('#vPct').textContent:10}</span>%)`);setText('#tfTotal',t('total'));setText('#btnAddTxt',t('add'));setText('#btnClearTxt',t('clear'));setText('#lblProps',t('props'));setText('#lblArt',t('art'));setText('#lblLoc',t('loc'));setText('#lblNotes',t('notes'));setText('#lblVendor',t('vendor'));setText('#printLabel',t('pdfPreview'));setText('#p_title',t('quotation'));setText('#p_thCat',t('cat'));setText('#p_thDesc',t('desc'));setText('#p_thUnit',t('unit'));setText('#p_thQty',t('qty'));setText('#p_thSub',t('sub'));setText('#p_tfSubtotal',t('subtotal'));setText('#p_tfTotal',t('total'));setText('#memoLabel',t('notes'));setText('#proTitle',t('pro'));setText('#loginTitle',t('login'));setText('#btnLogin',t('login'));setText('#btnGoogle',t('loginWithGoogle'));setText('#btnOpenSignup',t('signup'));setText('#btnForgotPass',t('forgot'));setText('#lblEmail',t('email'));setText('#lblPass',t('password'));setText('#signupTitle',t('signup'));setText('#lblEmail2',t('email'));setText('#lblPassword',t('password'));setText('#lblPassConfirm',t('passConfirm'));setText('#lblGender',t('gender'));setText('#lblPhone',t('phone'));setText('#lblRole',t('role'));setText('#lblVerify',t('verification'));setText('#btnSendCode',t('send'));setText('#lblCardReg',t('cardReg'));setText('#lblCardHint',t('cardHint'));setText('#lblCardDesc',t('cardDesc'));setText('#btnSubscribe',t('subscribe'));setText('#upgradeTitle',t('upgradeTitle'));setText('#upgradeDesc',t('upgradeDesc'));setText('#btnUpLogin',t('login'));setText('#btnUpSignup',t('signup'));const role=$('#sgRole');if(role&&role.options.length>=4){role.options[0].text=t('company');role.options[1].text=t('student');role.options[2].text=t('freelancer');role.options[3].text=t('other')}setText('#p_leftBrand',t('brand'));rebuildPresets()}const FX={base:'KRW',rates:{KRW:1,USD:0.00074,EUR:0.00067,JPY:0.11,GBP:0.00057,AUD:0.00112,CAD:0.00102}};function fxKRWtoSel(v){return(FX.rates[currency]||1)*(v||0)}function money(n){const v=fmt2(n);try{return new Intl.NumberFormat(localeUI==='ko'?'ko-KR':localeUI,{style:'currency',currency}).format(v)}catch(e){return(currency==='KRW'?'‚Ç©':currency)+' '+v.toLocaleString()}}function setFxStatus(msg,isError=false){const el=$('#fxStatus');if(!el)return;el.textContent=msg||'';el.style.color=isError?'#ff8aa3':'#86a0c5'}function refreshRates(){const key='FX_CACHE_V1';try{const cached=JSON.parse(localStorage.getItem(key)||'null');if(cached&&Date.now()-cached.ts<1000*60*60*6&&cached.rates){Object.assign(FX.rates,cached.rates);setFxStatus('Using cached FX')}}catch{}fetch('https://api.exchangerate.host/latest?base=KRW&symbols=USD,EUR,JPY,GBP,AUD,CAD').then(r=>r.json()).then(j=>{if(j?.rates){Object.assign(FX.rates,j.rates);localStorage.setItem(key,JSON.stringify({ts:Date.now(),rates:FX.rates}));setFxStatus('Rates updated');calc()}}).catch(()=>{setFxStatus('FX update failed ‚Äî cached/default used',true);calc()})}function addRow(row={cat:t('cat'),desc:'',price:0,qty:1}){const tr=document.createElement('tr');const tdCat=document.createElement('td');const iCat=document.createElement('input');iCat.value=row.cat||'';tdCat.appendChild(iCat);const tdDesc=document.createElement('td');const iDesc=document.createElement('input');iDesc.value=row.desc||'';tdDesc.appendChild(iDesc);const tdUnit=document.createElement('td');tdUnit.className='right';const iUnit=document.createElement('input');iUnit.type='number';iUnit.value=Number(row.price||0);tdUnit.appendChild(iUnit);const tdQty=document.createElement('td');tdQty.className='right';const iQty=document.createElement('input');iQty.type='number';iQty.value=Number(row.qty||1);tdQty.appendChild(iQty);const tdSub=document.createElement('td');tdSub.className='right subtotal';tdSub.textContent='0';const tdDel=document.createElement('td');tdDel.className='no-print';const b=document.createElement('button');b.className='btn btnDel';b.textContent='‚úñ';tdDel.appendChild(b);tr.append(tdCat,tdDesc,tdUnit,tdQty,tdSub,tdDel);$('#itemsBody')?.appendChild(tr);calc()}function presetFill(type){const body=$('#itemsBody');if(!body)return;body.innerHTML='';const add=arr=>arr.forEach(addRow);const L={planning:{ko:'Í∏∞Ìöç',en:'Planning',ja:'‰ºÅÁîª'},shooting:{ko:'Ï¥¨ÏòÅ',en:'Shooting',ja:'ÊíÆÂΩ±'},gear:{ko:'Ïû•ÎπÑ',en:'Gear',ja:'Ê©üÊùê'},post:{ko:'ÌõÑÎ∞ò',en:'Post',ja:'„Éù„Çπ„Éà'},studio:{ko:'Ïä§ÌäúÎîîÏò§',en:'Studio',ja:'„Çπ„Çø„Ç∏„Ç™'},makeup:{ko:'Î©îÏù¥ÌÅ¨ÏóÖ',en:'Makeup',ja:'„É°„Ç§„ÇØ'},talent:{ko:'Î∞∞Ïö∞/Î™®Îç∏/ÏïÑÌã∞Ïä§Ìä∏',en:'Talent',ja:'„Çø„É¨„É≥„Éà'}};const w=k=>L[k]?.[localeUI]||L[k]?.en||k;if(type==='shorts')add([{cat:w('planning'),price:200000,qty:1},{cat:w('shooting'),price:300000,qty:1},{cat:w('gear'),price:200000,qty:1},{cat:w('post'),price:300000,qty:1}]);else if(type==='youtube')add([{cat:w('planning'),price:300000,qty:1},{cat:w('shooting'),price:500000,qty:1},{cat:w('gear'),price:400000,qty:1},{cat:w('post'),price:400000,qty:1}]);else if(type==='mv')add([{cat:w('planning'),price:700000,qty:1},{cat:w('shooting'),price:1200000,qty:1},{cat:w('gear'),price:900000,qty:1},{cat:w('studio'),price:700000,qty:1},{cat:w('post'),price:1200000,qty:1},{cat:w('makeup'),price:200000,qty:1}]);else if(type==='cf')add([{cat:w('planning'),price:2000000,qty:1},{cat:w('shooting'),price:3500000,qty:2},{cat:w('gear'),price:3000000,qty:2},{cat:w('studio'),price:2500000,qty:1},{cat:w('post'),price:4000000,qty:1},{cat:w('makeup'),price:400000,qty:1},{cat:w('talent'),price:800000,qty:2}]);else if(type==='event')add([{cat:w('shooting'),price:800000,qty:1},{cat:w('gear'),price:700000,qty:1},{cat:t('cat'),price:300000,qty:2},{cat:w('post'),price:400000,qty:1}]);else if(type==='threeD')add([{cat:t('cat'),desc:'Lookdev/Pipeline',price:1500000,qty:1},{cat:t('cat'),desc:'Assets',price:1500000,qty:2},{cat:t('cat'),desc:'Animation',price:500000,qty:10},{cat:w('post'),desc:'Comp/Sound',price:1500000,qty:1}]);else if(type==='long10')add([{cat:w('planning'),price:1500000,qty:1},{cat:w('shooting'),price:2000000,qty:2},{cat:w('gear'),price:1800000,qty:2},{cat:w('studio'),price:1200000,qty:1},{cat:w('makeup'),price:400000,qty:1},{cat:w('talent'),price:800000,qty:2},{cat:w('post'),price:2500000,qty:1}]);else if(type==='long30')add([{cat:w('planning'),price:3000000,qty:1},{cat:w('shooting'),price:4000000,qty:4},{cat:w('gear'),price:3500000,qty:3},{cat:w('studio'),price:2500000,qty:2},{cat:w('makeup'),price:1200000,qty:1},{cat:w('talent'),price:2500000,qty:3},{cat:w('post'),price:6000000,qty:1}]);else if(type==='long60')add([{cat:w('planning'),price:6000000,qty:1},{cat:w('shooting'),price:8000000,qty:6},{cat:w('gear'),price:7000000,qty:4},{cat:w('studio'),price:4500000,qty:3},{cat:w('makeup'),price:2500000,qty:1},{cat:w('talent'),price:5000000,qty:4},{cat:w('post'),price:12000000,qty:1}]);else addRow();calc()}function calc(){const rows=$$('#itemsBody tr');let subtotal=0;rows.forEach(tr=>{const[cat,desc,price,qty]=$$('input',tr);const s=(parseFloat(price?.value||0)*parseFloat(qty?.value||0));subtotal+=s;const subcell=$('.subtotal',tr);if(subcell)subcell.textContent=money(fxKRWtoSel(s))});const propsPct=parseFloat($('#propsLevel')?.value||0);const artPct=parseFloat($('#artLevel')?.value||0);const locPct=parseFloat($('#locLevel')?.value||0);const cPct=propsPct+artPct+locPct;setText('#cPctView',cPct);const base=subtotal+subtotal*(cPct/100);const marginAmt=base*(marginPct/100);const vatPct=parseFloat($('#vat')?.value||0);const vatAmt=(base+marginAmt)*(vatPct/100);const grand=base+marginAmt+vatAmt;setText('#subtotal',money(fxKRWtoSel(subtotal)));setText('#complexAmt',money(fxKRWtoSel(subtotal*(cPct/100))));setText('#marginAmt',money(fxKRWtoSel(marginAmt)));setText('#vatAmt',money(fxKRWtoSel(vatAmt)));setText('#grand',money(fxKRWtoSel(grand)));const tbody=$('#p_table tbody');if(tbody){tbody.innerHTML='';rows.forEach(tr=>{const[cat,desc,price,qty]=$$('input',tr);const s=(parseFloat(price?.value||0)*parseFloat(qty?.value||0));const pr=document.createElement('tr');const td1=document.createElement('td');td1.textContent=cat?.value||'';const td2=document.createElement('td');td2.textContent=desc?.value||'';const td3=document.createElement('td');td3.className='right';td3.textContent=money(fxKRWtoSel(parseFloat(price?.value||0)));const td4=document.createElement('td');td4.className='right';td4.textContent=qty?.value||0;const td5=document.createElement('td');td5.className='right';td5.textContent=money(fxKRWtoSel(s));pr.append(td1,td2,td3,td4,td5);tbody.appendChild(pr)})}setText('#p_client',$('#client')?.value||t('client'));setText('#p_date',$('#date')?.value||new Date().toISOString().slice(0,10));setText('#memoBox',$('#notes')?.value||'');setText('#p_vendor',$('#vendor')?.value||'');setText('#p_cPct',cPct);setText('#p_mPct',$('#mPct')?.textContent||'15');setText('#p_vPct',vatPct);setText('#p_subtotal',$('#subtotal')?.textContent||'0');setText('#p_complexAmt',$('#complexAmt')?.textContent||'0');setText('#p_marginAmt',$('#marginAmt')?.textContent||'0');setText('#p_vatAmt',$('#vatAmt')?.textContent||'0');setText('#p_grand',$('#grand')?.textContent||'0')}function toast(msg){const t=document.createElement('div');t.id='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.classList.add('show'),10);setTimeout(()=>{t.classList.remove('show');t.remove()},1800)}function openModal(id){const el=$(id);if(el){el.style.display='flex'}}function closeModal(id){const el=$(id);if(el){el.style.display='none'}}function afterLogin(email){closeModal('#loginModal');const bar=$('#btnLoginOpen')?.parentElement;if(!bar)return;const mail=document.createElement('div');mail.className='small';mail.textContent=email;bar.insertBefore(mail,$('#btnLoginOpen'));setText('#btnLoginOpen',localeUI==='ko'?'Î°úÍ∑∏ÏïÑÏõÉ':'Logout');$('#btnLoginOpen').onclick=()=>location.reload()}function bind(){const today=new Date().toISOString().slice(0,10);const dateEl=$('#date');if(dateEl)dateEl.value=today;const brand=$('#brandName');if(brand)brand.onclick=()=>location.reload();const proTop=$('#btnProTop');if(proTop)proTop.onclick=()=>openModal('#upgradeModal');const upBtn=$('#btnUpgrade');if(upBtn)upBtn.onclick=()=>openModal('#upgradeModal');const loginOpen=$('#btnLoginOpen');if(loginOpen)loginOpen.onclick=()=>openModal('#loginModal');const loginClose=$('#loginClose');if(loginClose)loginClose.onclick=()=>closeModal('#loginModal');const openSignup=$('#btnOpenSignup');if(openSignup)openSignup.onclick=()=>{closeModal('#loginModal');openModal('#signupModal')};const signupClose=$('#signupClose');if(signupClose)signupClose.onclick=()=>closeModal('#signupModal');const upgradeClose=$('#upgradeClose');if(upgradeClose)upgradeClose.onclick=()=>closeModal('#upgradeModal');const btnLogin=$('#btnLogin');if(btnLogin)btnLogin.onclick=()=>afterLogin($('#authEmail')?.value||'user@example.com');const btnGoogle=$('#btnGoogle');if(btnGoogle)btnGoogle.onclick=()=>afterLogin('google-user@example.com');const upLogin=$('#btnUpLogin');if(upLogin)upLogin.onclick=()=>{closeModal('#upgradeModal');openModal('#loginModal')};const upSignup=$('#btnUpSignup');if(upSignup)upSignup.onclick=()=>{closeModal('#upgradeModal');openModal('#signupModal')};const subscribe=$('#btnSubscribe');if(subscribe)subscribe.onclick=()=>{toast('Redirecting to card page (stub)');setTimeout(()=>{closeModal('#signupModal');toast(t('signupDone'))},800)};const sendCode=$('#btnSendCode');if(sendCode)sendCode.onclick=()=>toast('Verification code sent');const uiSel=$('#uiLang');if(uiSel)uiSel.onchange=e=>{localeUI=e.target.value; if(!I18N[localeUI]) localeUI='en'; applyI18n();calc()};const curSel=$('#currency');if(curSel)curSel.onchange=e=>{currency=e.target.value;calc()};['#vat','#propsLevel','#artLevel','#locLevel','#notes','#vendor'].forEach(id=>{const el=$(id);if(!el)return;el.addEventListener(id==='#notes'?'input':'change',calc)});const add=$('#add');if(add)add.onclick=()=>addRow();const clear=$('#clear');if(clear)clear.onclick=()=>{$('#itemsBody').innerHTML='';calc()};const bProps=$('#btnProps');if(bProps)bProps.onclick=()=>addRow({cat:t('props'),price:200000,qty:1});const bArt=$('#btnArt');if(bArt)bArt.onclick=()=>addRow({cat:t('art'),price:300000,qty:1});const bLoc=$('#btnLoc');if(bLoc)bLoc.onclick=()=>addRow({cat:t('loc'),price:200000,qty:1});const bTalent=$('#btnTalent');if(bTalent)bTalent.onclick=()=>addRow({cat:'Talent',price:500000,qty:1});const bMake=$('#btnMakeup');if(bMake)bMake.onclick=()=>addRow({cat:'Makeup',price:200000,qty:1});const body=$('#itemsBody');if(body){body.addEventListener('click',e=>{if(e.target.classList.contains('btnDel')){e.target.closest('tr').remove();calc()}});body.addEventListener('input',e=>{if(e.target.tagName==='INPUT')calc()})}const preset=$('#preset');if(preset)preset.onchange=e=>presetFill(e.target.value);const printBtn=$('#btnPrint');if(printBtn)printBtn.onclick=()=>window.print()}function init(){localeUI=$('#uiLang')?.value||'en';if(!I18N[localeUI])localeUI='en';currency=$('#currency')?.value||'USD';applyI18n();rebuildPresets();presetFill('custom');bind();refreshRates();calc();smokeTest()}function smokeTest(){const ids=['#fxStatus','#memoLabel','#lblNotes','#lblVendor','#p_table','#p_title','#p_leftBrand'];const missing=ids.filter(s=>!$(s));if(missing.length){console.warn('Missing elements:',missing)}else{console.log('UI check OK')}addRow({cat:'Test',price:1000,qty:2});const g=$('#grand')?.textContent||'';if(!g||g==='0'){console.warn('Calc check: total not updated')}else{console.log('Calc check OK:',g)}}document.addEventListener('DOMContentLoaded',init);</script><!-- Supabase JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/** 1) ÌôòÍ≤ΩÍ∞í (ÎÑàÏùò ÌîÑÎ°úÏ†ùÌä∏ Í≤ÉÏúºÎ°ú Î∞îÍøî ÎÑ£Í∏∞) **/
const SUPABASE_URL = 'https://YOUR-PROJECT.supabase.co';   // ‚Üê Settings > API Ïùò Project URL
const SUPABASE_ANON_KEY = 'YOUR-ANON-PUBLIC-KEY';          // ‚Üê anon public key
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/** 2) ÏóòÎ¶¨Î®ºÌä∏ Ï∫êÏãú (Ïù¥ÎØ∏ HTMLÏóê ÏûàÎäî idÎì§Ïóê ÎßûÏ∂§) **/
const $ = (q) => document.querySelector(q);
const emailInput   = $('#sgEmail');      // Ïù¥Î©îÏùº
const otpInput     = $('#sgCode');       // Ïù∏Ï¶ùÏΩîÎìú 6ÏûêÎ¶¨
const passInput    = $('#sgPass');       // ÎπÑÎ∞ÄÎ≤àÌò∏
const pass2Input   = $('#sgPass2');      // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
const sendBtn      = $('#btnSendCode');  // "Î∞úÏÜ°" Î≤ÑÌäº
const subscribeBtn = $('#btnSubscribe'); // "Íµ¨ÎèÖ" Î≤ÑÌäº (Í≤∞Ï†ú ÌõÑ Í∞ÄÏûÖ ÏôÑÎ£å Î≤ÑÌäº Ïó≠Ìï†)
const loginOpenBtn = $('#btnLoginOpen'); // Î°úÍ∑∏Ïù∏ Ïó¥Í∏∞ Î≤ÑÌäº(ÏûàÏúºÎ©¥)

/** UXÏö© ÌÜ†Ïä§Ìä∏ */
function toast(msg, ok=false){
  const t=document.createElement('div');
  t.textContent=msg;
  t.style.cssText='position:fixed;right:16px;bottom:16px;z-index:99999;padding:10px 14px;border-radius:10px;color:#fff;'+
                  (ok?'background:#22c55e;':'background:#ef4444;');
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 2600);
}

/** 3) Ïù¥Î©îÏùºÎ°ú OTP(6ÏûêÎ¶¨ ÏΩîÎìú) Î≥¥ÎÇ¥Í∏∞
 *  Supabase Auth ‚Üí Email OTP(6) ÌôúÏÑ±Ìôî + SMTP(Resend) ÏÑ∏ÌåÖÏù¥ ÎÅùÎÇò ÏûàÏñ¥Ïïº ÎèôÏûëÌï®
 */
async function sendEmailOtp(){
  const email = (emailInput?.value||'').trim();
  if(!email){ toast('Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî'); return; }

  // Ïù¥ÎØ∏ Í∞ÄÏûÖÌïú Ïù¥Î©îÏùºÏù¥ÎùºÎèÑ OTP Î°úÍ∑∏Ïù∏/ÌôïÏù∏ÏùÄ Î≥¥ÎÇº Ïàò ÏûàÏùå(Î†àÏù¥Ìä∏Î¶¨Î∞ã Ï£ºÏùò)
  const { data, error } = await supabase.auth.signInWithOtp({
    email,
    options: {
      // ÏÇ¨Ïö©ÏûêÍ∞Ä ÎßÅÌÅ¨Î•º ÎàåÎ†ÄÏùÑ Îïå ÎèåÏïÑÏò¨ URL (ÏÑ†ÌÉù)
      emailRedirectTo: 'https://frame-quote.com/#welcome'
    }
  });
  if(error){
    console.error(error);
    toast(error.message || 'Ïù∏Ï¶ùÏΩîÎìú Î∞úÏÜ° Ïã§Ìå®');
  }else{
    localStorage.setItem('fq_signup_email', email);
    toast('Ïù∏Ï¶ùÏΩîÎìúÎ•º Î≥¥ÎÉàÏäµÎãàÎã§. Î©îÏùºÌï®ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî ‚úÖ', true);
  }
}

/** 4) Ïù∏Ï¶ùÏΩîÎìú(6ÏûêÎ¶¨) Í≤ÄÏ¶ù + ÌöåÏõê Ï†ïÎ≥¥(ÎπÑÎ≤à) ÏÑ∏ÌåÖ
 *   - Ïù¥Î©îÏùº OTPÎäî "verifyOtp"Î°ú Í≤ÄÏ¶ù
 *   - Í≤ÄÏ¶ù ÏÑ±Í≥µ ÌõÑ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏÑ∏ÌåÖ(Ï≤òÏùå Í∞ÄÏûÖÌïú Ïú†Ï†ÄÎäî Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±Îê®)
 */
async function verifyEmailOtpAndSetPassword(){
  const email = (emailInput?.value || localStorage.getItem('fq_signup_email') || '').trim();
  const token = (otpInput?.value||'').trim();
  const pass  = (passInput?.value||'').trim();
  const pass2 = (pass2Input?.value||'').trim();

  if(!email) { toast('Ïù¥Î©îÏùºÏù¥ ÎπÑÏóàÏäµÎãàÎã§'); return; }
  if(!token || token.length !== 6) { toast('Ïù∏Ï¶ùÏΩîÎìú 6ÏûêÎ¶¨Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî'); return; }
  if(!pass || pass.length < 6) { toast('ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 6Ïûê Ïù¥ÏÉÅ'); return; }
  if(pass !== pass2) { toast('ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏Ïù¥ ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§'); return; }

  // 4-1) OTP Í≤ÄÏ¶ù
  const { data: vData, error: vErr } = await supabase.auth.verifyOtp({
    email,
    token,
    type: 'email'  // Ïù¥Î©îÏùº OTP
  });
  if(vErr){
    console.error(vErr);
    toast(vErr.message || 'Ïù∏Ï¶ùÏΩîÎìú ÌôïÏù∏ Ïã§Ìå®');
    return;
  }

  // 4-2) ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï(ÎòêÎäî Î≥ÄÍ≤Ω)
  const { data: uData, error: uErr } = await supabase.auth.updateUser({ password: pass });
  if(uErr){
    console.error(uErr);
    toast(uErr.message || 'ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï Ïã§Ìå®');
    return;
  }

  // 4-3) ÌîÑÎ°úÌïÑ ÌÖåÏù¥Î∏îÏóê Í∏∞Î≥∏ Ï†ïÎ≥¥ Ï†ÄÏû•(ÏûàÏúºÎ©¥ upsert)
  try{
    await supabase.from('profiles')
      .upsert({ user_id: uData.user.id, email, role: $('#sgRole')?.value||null, phone: $('#sgPhone')?.value||null }, { onConflict: 'user_id' });
  }catch(e){ console.warn('profiles upsert warn', e); }

  toast('Ïù∏Ï¶ù ÏôÑÎ£å! Ïù¥Ï†ú Í≤∞Ï†úÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî ‚úÖ', true);
  // Ïó¨Í∏∞ÏóêÏÑú Í≤∞Ï†ú ÌéòÏù¥ÏßÄÎ°ú Î≥¥ÎÇº ÏàòÎèÑ ÏûàÏùå(ÏïÑÎûò Stripe ÏÑπÏÖò Ï∞∏Í≥†)
}

/** 5) Íµ¨ÎèÖ(Í≤∞Ï†ú) ‚Üí ÏÑ±Í≥µ ÌõÑ Í∞ÄÏûÖ ÏµúÏ¢Ö ÏôÑÎ£å Ï≤òÎ¶¨
 *    - Í≤∞Ï†ú ÏÑ±Í≥µ Î¶¨Îã§Ïù¥Î†âÌä∏ URLÏóê ?checkout=success Í∞ôÏùÄ ÏøºÎ¶¨Î°ú ÎèåÏïÑÏò§Í≤å ÌïòÍ≥†
 *      Í∑∏Îïå pro=true ÌîåÎûòÍ∑∏Î•º Ï†ÄÏû•Ìï¥ Ï£ºÎ©¥ ÎÅù.
 */
async function finalizeAfterCheckout(){
  const params = new URLSearchParams(location.search);
  if(params.get('checkout') === 'success'){
    const { data: userRes } = await supabase.auth.getUser();
    const user = userRes?.user;
    if(user){
      await supabase.from('profiles').upsert({ user_id: user.id, pro: true }, { onConflict: 'user_id' });
      toast('Íµ¨ÎèÖÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§. ÌôòÏòÅÌï©ÎãàÎã§! üéâ', true);
    }
  }
}

/** 6) Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî© */
sendBtn?.addEventListener('click', sendEmailOtp);
subscribeBtn?.addEventListener('click', async () => {
  // (ÏûÑÏãú) Í≤∞Ï†ú ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô ‚Äî Ïã§Ï†ú Í≤∞Ï†úÎäî Stripe Checkout ÎßÅÌÅ¨/Ìè¨ÌÑ∏Î°ú Î∞îÍøî ÎÑ£Í∏∞
  // Ïòà: location.href = 'https://checkout.stripe.com/c/xxx';
  toast('Í≤∞Ï†ú ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§ (Îç∞Î™®)', true);
  // Îç∞Î™®ÎùºÎ©¥ Í∑∏ÎÉ• Ï¶âÏãú ÏôÑÎ£åÎ°ú Í∞ÄÏ†ïÌï¥ÏÑú ÏïÑÎûò ÎùºÏù∏ÏùÑ ÏºúÎèÑ Îê®:
  // location.href = location.origin + location.pathname + '?checkout=success';
});

// Î°úÍ∑∏Ïù∏ Î™®Îã¨ÏóêÏÑú "Î°úÍ∑∏Ïù∏" Î≤ÑÌäº ÎàÑÎ•º ÎïåÎäî signInWithPassword Îì±ÏùÑ Ïó∞Í≤∞Ìï¥ÎèÑ Îê®.
// (ÎÑ§Í∞Ä Ïù¥ÎØ∏ afterLogin(email) Í∞ôÏùÄ UI Ìï®ÏàòÍ∞Ä ÏûàÏúºÎãà, ÏÑ±Í≥µ ÌõÑ Í∑∏Í±∏ Ìò∏Ï∂úÌïòÍ≤å ÌïòÎ©¥ Îê®.)

// Ï¥àÍ∏∞ Ìò∏Ï∂ú
finalizeAfterCheckout();
</script>
</body></html>
